-------------------------------------------------------------------------------------------------------------- Copyright (c) 2014-2018 FirstOne Media ---------------------------------------------------------------- Commercial use or Copyright removal is ------------ strictly prohibited without permission --------------------------------------------------------------------------------------------------------------local whitelistDomains = {"APIDOMAIN",--- GOOGLE-DOMAINS (some already whitelisted: https://github.com/multitheftauto/mtasa-blue/blob/master/Client/cefweb/CWebCore.cpp#L192 ) ---"googlecode.com","clients.google.de","clients1.google.de","clients2.google.de","clients3.google.de","clients.google.com","clients1.google.com","clients2.google.com","clients3.google.com","www.googlecode.com","googlesource.com","www.googlesource.com","googlesyndication.com","www.googlesyndication.com","ade.googlesyndication.com","tpc.googlesyndication.com","pagead1.googlesyndication.com","pagead2.googlesyndication.com","goo.gl","www.goo.gl","youtube-nocookie.com","www.youtube-nocookie.com","ggpht.com","www.ggpht.com","lh0.ggpht.com","lh1.ggpht.com","lh2.ggpht.com","lh3.ggpht.com","lh4.ggpht.com","lh5.ggpht.com","lh6.ggpht.com","yt0.ggpht.com","yt1.ggpht.com","yt2.ggpht.com","yt3.ggpht.com","yt4.ggpht.com","yt5.ggpht.com","yt6.ggpht.com","gstatic.com","www.gstatic.com","ssl.gstatic.com","csi.gstatic.com","fonts.gstatic.com","maps.gstatic.com","encrypted-tbn0.gstatic.com","encrypted-tbn1.gstatic.com","encrypted-tbn2.gstatic.com","encrypted-tbn3.gstatic.com","encrypted-tbn4.gstatic.com","encrypted-tbn5.gstatic.com","encrypted-tbn6.gstatic.com","encrypted-tbn7.gstatic.com","encrypted-tbn8.gstatic.com","encrypted-tbn9.gstatic.com","t0.gstatic.com","t1.gstatic.com","t2.gstatic.com","t3.gstatic.com","t4.gstatic.com","t5.gstatic.com","t6.gstatic.com","googleapis.com","www.googleapis.com","ajax.googleapis.com","fonts.googleapis.com","googleusercontent.com","www.googleusercontent.com","lh0.googleusercontent.com","lh1.googleusercontent.com","lh2.googleusercontent.com","lh3.googleusercontent.com","lh4.googleusercontent.com","lh5.googleusercontent.com","lh6.googleusercontent.com","s1.googleusercontent.com","s2.googleusercontent.com","s3.googleusercontent.com","s4.googleusercontent.com","s5.googleusercontent.com","s6.googleusercontent.com","s7.googleusercontent.com","s8.googleusercontent.com","s9.googleusercontent.com","oauth.googleusercontent.com","mail-attachment.googleusercontent.com","google-analytics.com","www.google-analytics.com","ssl.google-analytics.com","googleads.g.doubleclick.net","googleads1.g.doubleclick.net","googleads2.g.doubleclick.net","googleads3.g.doubleclick.net","googleads4.g.doubleclick.net","googleads5.g.doubleclick.net","googleads6.g.doubleclick.net","googleads7.g.doubleclick.net","googleads8.g.doubleclick.net","googleads9.g.doubleclick.net","ad.doubleclick.net","static.doubleclick.net","cm.g.doubleclick.net","www.googleadservices.com","stats.g.doubleclick.net","adclick.g.doubleclick.net","googleads1.g.doubleclick.net","2mdn.net","gcdn.2mdn.net","s0.2mdn.net","s1.2mdn.net","s2.2mdn.net","www.googletagservices.com","googletagservices.com",-- Anderes --"jquery.com","www.jquery.com","code.jquery.com","bootstrapcdn.com","www.bootstrapcdn.com","maxcdn.bootstrapcdn.com","github.com","www.github.com","githubusercontent.com","www.githubusercontent.com","raw.githubusercontent.com","sourceforge.net","www.sourceforge.net","fastcounter.de","www.fastcounter.de","cdnjs.cloudflare.com","crossorigin.me","www.crossorigin.me","cache.vevo.com","h264-aws.vevo.com","img.cache.vevo.com","apiv2.vevo.com","gwa.lphbs.com","livepassdl.conviva.com","hls-aws.vevo.com","player.vimeo.com","f.vimeocdn.com","i.vimeocdn.com","13-lvl3-pdl.vimeocdn.com","13-lvl3-hls.vimeocdn.com","game-state.com","www.game-state.com","twitch.tv","www.twitch.tv","player.twitch.tv","imageloader.de","www.imageloader.de","abload.de","www.abload.de","j.gifs.com","gifs.com","www.gifs.com","www.fotos-hochladen.net","fotos-hochladen.net","img1.fotos-hochladen.net","img2.fotos-hochladen.net","img3.fotos-hochladen.net","img4.fotos-hochladen.net","img5.fotos-hochladen.net","img6.fotos-hochladen.net","img7.fotos-hochladen.net","img8.fotos-hochladen.net","img9.fotos-hochladen.net","www.directupload.net","directupload.net","fs1.directupload.net","fs2.directupload.net","fs3.directupload.net","fs4.directupload.net","fs5.directupload.net","fs6.directupload.net","fs7.directupload.net","fs8.directupload.net","fs9.directupload.net","i.imagebanana.com","www.imagebanana.com","imagebanana.com","i.gyazo.com","www.gyazo.com","gyazo.com","up.picr.de","www.picr.de","picr.de","www.bilder-upload.eu","bilder-upload.eu","cdn.jsdelivr.net","cloudfront.net","d22v2nmahyeg2a.cloudfront.net","d31qbv1cthcecs.cloudfront.net","h5p2p.peer-stream.com","h5p2p0.peer-stream.com","r0-eu-am-h5dash0.supersmart.tv","time.akamai.com","i.epvpimg.com","abload.de","pic-upload.de","www1.pic-upload.de","www2.pic-upload.de","www3.pic-upload.de","www4.pic-upload.de","www5.pic-upload.de","www6.pic-upload.de","www7.pic-upload.de","www8.pic-upload.de","www9.pic-upload.de","www10.pic-upload.de","www11.pic-upload.de","www12.pic-upload.de","cdn.mathjax.org",-- Facebook --"facebook.com","www.facebook.com","de-de.facebook.com","pixel.facebook.com","touch.facebook.com","developers.facebook.com","newsroom.facebook.com","apps.facebook.com","staticxx.facebook.com","graph.facebook.com","upload.facebook.com","login.facebook.com","secure.facebook.com","latest.facebook.com","inyour.facebook.com","beta.facebook.com","connect.facebook.com","www.connect.facebook.com","weblog.facebook.com","act.facebook.com","es.facebook.com","www-dev.facebook.com","p.facebook.com","wwwroot.facebook.com","sun.facebook.com","sms.facebook.com","ads.facebook.com","bc.facebook.com","ssl.facebook.com","delta.facebook.com","dns.facebook.com","light.facebook.com","udp.facebook.com","new.facebook.com","api.facebook.com","m.c.facebook.com","test.facebook.com","lm.facebook.com","free.facebook.com","nic.facebook.com","accounts.facebook.com","canvas.facebook.com","id-id.facebook.com","enc.facebook.com","w.facebook.com","o.facebook.com","blog.facebook.com","my.facebook.com","target.facebook.com","chat.facebook.com","port.facebook.com","fb.com","fb.me","static.xx.fbcdn.net","cx.atdmt.com","cdn.rawgit.com","external-ams1-1.xx.fbcdn.net","scontent-ams1-1.xx.fbcdn.net","video-ams1-1.xx.fbcdn.net","external-ams2-1.xx.fbcdn.net","scontent-ams2-1.xx.fbcdn.net","video-ams2-1.xx.fbcdn.net","external-ams3-1.xx.fbcdn.net","scontent-ams3-1.xx.fbcdn.net","video-ams3-1.xx.fbcdn.net","external-amt1-1.xx.fbcdn.net","scontent-amt1-1.xx.fbcdn.net","video-amt1-1.xx.fbcdn.net","external-amt2-1.xx.fbcdn.net","scontent-amt2-1.xx.fbcdn.net","video-amt2-1.xx.fbcdn.net","external-amt3-1.xx.fbcdn.net","scontent-amt3-1.xx.fbcdn.net","video-amt3-1.xx.fbcdn.net","external-sin1-1.xx.fbcdn.net","scontent-sin1-1.xx.fbcdn.net","video-sin1-1.xx.fbcdn.net","external-sin2-1.xx.fbcdn.net","scontent-sin2-1.xx.fbcdn.net","video-sin1-2.xx.fbcdn.net","external-sin1-3.xx.fbcdn.net","scontent-sin1-3.xx.fbcdn.net","video-sin1-3.xx.fbcdn.net","external-cdg1-1.xx.fbcdn.net","scontent-cdg1-1.xx.fbcdn.net","video-cdg1-1.xx.fbcdn.net","external-cdg2-1.xx.fbcdn.net","scontent-cdg2-1.xx.fbcdn.net","video-cdg2-1.xx.fbcdn.net","external-cdg3-1.xx.fbcdn.net","scontent-cdg3-1.xx.fbcdn.net","video-cdg3-1.xx.fbcdn.net","external-b.xx.fbcdn.net","scontent-b.xx.fbcdn.net","video-b.xx.fbcdn.net","0-edge-chat.facebook.com","1-edge-chat.facebook.com","2-edge-chat.facebook.com","3-edge-chat.facebook.com","4-edge-chat.facebook.com","5-edge-chat.facebook.com","6-edge-chat.facebook.com","7-edge-chat.facebook.com","9-edge-chat.facebook.com","8-edge-chat.facebook.com","m.facebook.com","connect.facebook.net","connect.facebook.com","scontent.xx.fbcdn.net","fbcdn.net","fbsbx.com","edge-chat.facebook.com",-- WhatsApp --"whatsapp.net","www.whatsapp.net","whatsapp.com","www.whatsapp.com","web.whatsapp.com","crashlogs.whatsapp.net","w0.web.whatsapp.com","w1.web.whatsapp.com","w2.web.whatsapp.com","w3.web.whatsapp.com","w4.web.whatsapp.com","w5.web.whatsapp.com","w6.web.whatsapp.com","w7.web.whatsapp.com","w8.web.whatsapp.com","w9.web.whatsapp.com","dyn.web.whatsapp.com","mmg-fna.whatsapp.net","mmx-ds.cdn.whatsapp.net","mmx-fb.cdn.whatsapp.net","mmx.cdn.whatsapp.net","config.whatsapp.net","im103.whatsapp.net","bsg602.whatsapp.net","tsl102.whatsapp.net","wmb501.whatsapp.net","v.whatsapp.net","mts1.whatsapp.net","web301.whatsapp.net","c.whatsapp.net","b.ns.cdn.whatsapp.net","a.ns.cdn.whatsapp.net",-- Twitter --"twitter.com","www.twitter.com","syndication.twitter.com","twimg.com","www.twimg.com","abs.twimg.com","pbs.twimg.com","o.twimg.com","ton.twimg.com","amp.twimg.com","video.twimg.com","platform.twitter.com","mobile.twitter.com",-- Dailymotion --"dailymotion.com","www.dailymotion.com","dmcdn.net","static1.dmcdn.net","static2.dmcdn.net","static3.dmcdn.net","static1-ssl.dmcdn.net","static2-ssl.dmcdn.net","static3-ssl.dmcdn.net","api.dmcdn.net","graphql.api.dailymotion.com","s1-ssl.dmcdn.net","s1.dmcdn.net","s2-ssl.dmcdn.net","s2.dmcdn.net","s3-ssl.dmcdn.net","s3.dmcdn.net","dmxleo.dailymotion.com",-- Soundcloud --"soundcloud.com","www.soundcloud.com","sndcdn.com","style.sndcdn.com","a-v2.sndcdn.com","api-v2.soundcloud.com","i1.sndcdn.com","i2.sndcdn.com","i3.sndcdn.com","i4.sndcdn.com","i5.sndcdn.com","vt.myvisualiq.net","t.myvisualiq.net","idsync.rlcdn.com","l9bjkkhaycw6f8f4.soundcloud.com","api.soundcloud.com","cf-hls-opus-media.sndcdn.com","ec-preview-media.sndcdn.com","cf-media.sndcdn.com","cf-hls-media.sndcdn.com",-- TOP ALEXA --"wikipedia.org","www.wikipedia.org","de.wikipedia.org","en.wikipedia.org","wikimedia.org","upload.wikimedia.org","meta.wikimedia.org","commons.wikimedia.org","instagram.com","www.instagram.com","graph.instagram.com","instagram.com","external-ams1-1.cdninstagram.com","scontent-ams1-1.cdninstagram.com","video-ams1-1.cdninstagram.com","external-ams2-1.cdninstagram.com","scontent-ams2-1.cdninstagram.com","video-ams2-1.cdninstagram.com","external-ams3-1.cdninstagram.com","scontent-ams3-1.cdninstagram.com","video-ams3-1.cdninstagram.com","external-amt1-1.cdninstagram.com","scontent-amt1-1.cdninstagram.com","video-amt1-1.cdninstagram.com","external-amt2-1.cdninstagram.com","scontent-amt2-1.cdninstagram.com","video-amt2-1.cdninstagram.com","external-amt3-1.cdninstagram.com","scontent-amt3-1.cdninstagram.com","video-amt3-1.cdninstagram.com","external-sin1-1.cdninstagram.com","scontent-sin1-1.cdninstagram.com","video-sin1-1.cdninstagram.com","external-sin2-1.cdninstagram.com","scontent-sin2-1.cdninstagram.com","video-sin1-2.cdninstagram.com","external-sin1-3.cdninstagram.com","scontent-sin1-3.cdninstagram.com","video-sin1-3.cdninstagram.com","external-cdg1-1.cdninstagram.com","scontent-cdg1-1.cdninstagram.com","video-cdg1-1.cdninstagram.com","external-cdg2-1.cdninstagram.com","scontent-cdg2-1.cdninstagram.com","video-cdg2-1.cdninstagram.com","external-cdg3-1.cdninstagram.com","scontent-cdg3-1.cdninstagram.com","video-cdg3-1.cdninstagram.com",-- Sonstiges --"mta-sa.org","www.mta-sa.org","html5test.com","api.whichbrowser.net",}-- Add default radio domainsfor k, v in pairs(settings.systems.vehicle.radioStations) do	local dom = string.lower(string.match(v.url, '^%w+://([^/]+)'))	--outputChatBox(dom)	table.insert(whitelistDomains, dom)endfunction domainWhitelistCallback(accepted, newDoms)	if (accepted == true) then		--outputChatBox("DOMAINS ACCEPTED!")	else		notificationShow("error", "Um alle Funktionen des Servers nutzen zu können, musst Du die Domains bestätigen.", 10)		setTimer(function()			requestBrowserDomains(whitelistDomains, false, domainWhitelistCallback)		end, 100, 1)	endendrequestBrowserDomains(whitelistDomains, false, domainWhitelistCallback)local function checkSettings()	local settings = getBrowserSettings()	if (settings["RemoteEnabled"] == false or settings["RemoteJavascript"] == false) then		outputChatBox(" ", 255, 0, 0)		outputChatBox(" ", 255, 0, 0)		outputChatBox("Bitte Aktiviere folgende Option(en) unter 'Einstellungen -> Webbrowser' um alle Funktionen des Servers nutzen zu können:", 255, 0, 0)		if (settings["RemoteEnabled"] == false) then			outputChatBox("- Externe Webseiten aktivieren", 255, 0, 0)		end		if (settings["RemoteJavascript"] == false) then			outputChatBox("- Javascript auf exernen Webseiten", 255, 0, 0)		end	end	setTimer(checkSettings, 1000*30, 1)endcheckSettings()-- Geblockte resourcen whitelisten --local lastBrowser = nillocal function blockedFunc(url, domain, reason)	if (not source) then source = lastBrowser end	lastBrowser = source		outputConsole("@onClientBrowserResourceBlocked; Reason: "..reason.." - Domain: "..domain.." - URL: "..url)		-- reasons: 0=>not whitelisted, 1=>Blacklisted from MTA:SA, 2=>blocked protocol scheme	if (reason == 0) then				--[[local callback = function(accepted, newDoms, url, domain)			if (accepted == true) then				-- Reload the Browser				loadBrowserURL(source, url)			else				setTimer(function()					requestBrowserDomains({domain}, false, function(accepted, newDoms) callback(accepted, newDoms, url, domain) end)				end, 500, 1)			end		end]]				requestBrowserDomains({domain}, false, function(accepted, newDoms)			if (accepted == true) then				--reloadBrowserPage(lastBrowser) -- is kacke, lieber mit onClientBrowserWhitelistChange bei jeweiligen browser arbeiten.				lastBrowser = nil			else				setTimer(function()					blockedFunc(url, domain, reason, source)				end, 250, 1)			end		end)			endendaddEventHandler("onClientBrowserResourceBlocked", root, blockedFunc)